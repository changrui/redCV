rcvHistogramEqualization: function [ image [vector!]   newGrays [integer!]                   
;This function performs histogram equalization on the input image array
] [
	n: length? image
	histo: make vector! 256 ;[0..255]
	constant: to float! (newGrays) / to float! (n)
	
	; calculate histogram 
	i: 1
	while [i < n ] [
		k: image/(i)
		histo/(k + 1): histo/(k + 1) + 1
		i: i + 1
	]
	
	sumH: make vector! 256
	
	
	; calculate the sum of histogram
	sum: 0
	sumH: make vector! 256
	i: 1
	while [i <= 256] [
		sum: sum + histo/(i)
		sumH/(i): sum
		i: i + 1
	]
	
	; transform input image to output image
	
	i: 1 
	while [i <= n ] [
		k: image/(i)
		image/(i): to integer! (sumH/(k + 1) * constant)
		i: i + 1
	]
]